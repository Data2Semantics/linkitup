{% extends "dashboard.html" %}
<!-- <div width='300px'>
	{{ raw }}
</div> -->


<!-- {% block articles %}

<li class="dropdown">
	<a class="dropdown-toggle" data-toggle="dropdown" href="#">Articles <b class="caret"></b></a>
	<ul class="dropdown-menu">

	</ul>
</li>
{% endblock %} -->


{% block tabs %}
	{% for k,i in results.items %}
		<li class="span3 {% if forloop.first %}active{% endif %}"><a href="#{{ i.article_id }}_tab" data-toggle="tab">{{ i.title }}</a></li>
	{% endfor %}
{% endblock %}


{% block dbcontent %}
	{% for k,i in results.items %}
		<div class="span8 tab-pane {% if forloop.first %}active{% endif %}" id="{{ i.article_id }}_tab">
		<form id='{{ i.article_id }}_form' method='POST' action='process/{{ i.article_id }}'>
		{% csrf_token %}

			<div class="row">
				<div class="">
		 			<div class="well" id="{{ i.article_id }}_title">
						<strong>{{ i.title }}</strong> <small>(<em>{{ i.status }}</em>, {{ i.published_date }})</small><br/>
						<a href="{{i.doi}}">{{i.doi}}</a> 
	 				</div>
	 				<div id='{{ i.article_id }}_updated_figshare' class="alert alert-success">
					  <button type="button" class="close" data-dismiss="alert">&times;</button>
					  <strong>Success!</strong> <strong>Linki</strong>tup data has been pushed back to Figshare.
					</div>
				</div>
			</div>
			
			
			
			<div id="{{ i.article_id }}_details" style="margin-top: 1em;">
			<div class="row">
				<div class="span6">
					<div class="row">
						<div class="span1"><strong>files</strong></div>
						<div class="span5">
							<ul class="unstyled">
							{% for f in i.files %}
								<li><i class='icon-file'></i> {{ f.name }}</li>
							{% endfor %}
							</ul>
						</div>
					</div>
					{% if i.authors %}
					<div class="row">
						<div class="span1"><strong>authors</strong></div>
						<div class="span5">
							<ul class="unstyled">
							{% for a in i.authors %}
								<li><i class='icon-user'></i> {{ a.full_name }}</li>
							{% endfor %}
							</ul>
						</div>
					</div>
					{% endif %}
					{% if i.tags %}
					<div class="row">
						<div class="span1"><strong>tags</strong></div>
						<div class="span5">
							<ul class="unstyled">
							{% for t in i.tags %}
								<li><i class='icon-tag'></i> {{ t.name }}</li>
							{% endfor %}
							</ul>
						</div>
					</div>
					{% endif %}
					{% if i.links %}
					<div class="row">
						<div class="span1"><strong>links</strong></div>
						<div class="span5">
							<ul class="unstyled">
								{% for l in i.links %}
									{% if l.link|length > 51 %}
										<li><i class='icon-share-alt'></i> <a href="{{ l.link }}">{{ l.link|slice:":24" }}... {{ l.link|slice:"-24:" }}</a></li>
									{% else %}
										<li><i class='icon-share-alt'></i> <a href="{{ l.link }}">{{ l.link }}</a></li>
									{% endif %}
								{% endfor %}
							</ul>
						</div>
					</div>
					{% endif %}
					{% if i.categories %}
					<div class="row">
						<div class="span1"><strong>categories</strong></div>
						<div class="span5">
							<ul class="unstyled">
								{% for c in i.categories %}
								<li><i class='icon-th-list'></i> {{ c.name }}</a></li>
								{% endfor %}
							</ul>
						</div>
					</div>
					{% endif %}
				</div>
				<div class="span2">
					<div class="well" style="padding: 8px 0;">
					<ul class="nav nav-list">
						<li class="nav-header">Plugins</li>
						{% for plugin in plugins %}
							<li>{% include "button.html" %}</li>
						{% endfor %}
						<li class="nav-header">Actions</li>
						<li><a id="show_{{ i.article_id }}">Show Selection</a></li>
						<li><input type='button' data-role='submit' name='task' value='Download RDF' class='text-button' id="rdf_{{ i.article_id }}"/></li>
						<li><input type='button' data-role='submit' name='task' value='Add to Figshare' class='text-button' id="figshare_{{ i.article_id }}"/></li>
					</ul>
					</div>
				</div>			
			</div>
			</div>
			{% for plugin in plugins %}
				{% include "results.html" %}
			{% endfor %}
		</form>
		<div class="modal hide fade" id="links_{{ i.article_id }}" tabindex="-1" role="dialog" aria-hidden="true">
		  <div class="modal-header">
		    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		    <h3>Selected Links</h3>
		  </div>
		  <div id="links_modalbody_{{ i.article_id }}" class="modal-body">
		    <p>Loading...</p>
		  </div>
		  <div class="modal-footer">
		    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
		  </div>
		</div>

			
		<script>
		
			/* 			
 			// This bit was used to show and hide article details
 
 			$("#{{ i.article_id }}_details").hide();
			$("#{{ i.article_id }}_title").click(function(){
					$("#{{ i.article_id }}_details").toggle('');
			}) 
			*/
			
			$.ajaxSetup ({  
					        cache: false  
					    });
					
			$("#links_{{ i.article_id }}").hide();
			
			$("#show_{{ i.article_id }}").click(function(){

		        $("#links_modalbody_{{ i.article_id }}").empty(); 
		        
		        var start = "<label class='checkbox alert alert-info'><a href='";
		        var middle1 = "' target='_new'>";
		        var end = "</a></label>";
		        
				$("#{{ i.article_id }}_form :input[type='checkbox']:checked").each( 
						function(){
				        	if ($(this).attr('name') != 'csrfmiddlewaretoken') {
				          		$("#links_modalbody_{{ i.article_id }}").append(start + $(this).attr('web') + middle1 + $(this).attr('show') + end);
				        	}
		        });
		        
		        $("#links_{{ i.article_id }}").modal('show');
			});
			
			$("#{{ i.article_id }}_updated_figshare").hide();
			
			/*             
 			// This bit was used to submit the form (without refreshing the page)
 			$("#{{ i.article_id }}_form").submit( function () {    
                $.post(
                 'process/{{ i.article_id }}',
                  $(this).serialize(),
                  function(data){
                	 $("#{{ i.article_id }}_updated_figshare").show();
                  }
                );
                return false;   
              });   
			*/
		</script>
		</div>
	{% endfor %}
	<script>
		// data-role functionality
		$(function(){
		    $("[data-role=submit]").click(function(){
		        $(this).closest("form").submit();
		    });
		});
	
	</script>
{% endblock %}
